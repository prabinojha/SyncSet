<!DOCTYPE html>
<html>
<%- include('includes/head', {title: title}) %>

    <body class="<%= domainData && domainData.theme === 'dark' ? 'dark-theme' : 'light-theme' %>">
        <div class="subdomain-container">
            <div class="subdomain-content-section">
                <h1 id="subdomain-title">
                    <%= title %>
                </h1>
                <p id="subdomain-description">
                    <%= description %>
                </p>

                <div class="subdomain-calendar-section">
                    <div class="subdomain-calendar-grid">
                        <div class="subdomain-calendar-container">
                            <div class="subdomain-calendar-header">
                                <button id="subdomain-prevMonth" class="subdomain-calendar-nav-btn">&lt;</button>
                                <h2 id="subdomain-currentMonth">Month Year</h2>
                                <button id="subdomain-nextMonth" class="subdomain-calendar-nav-btn">&gt;</button>
                            </div>
                            <div class="subdomain-calendar-body">
                                <div class="subdomain-weekdays"></div>
                                <div class="subdomain-days"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subdomain-services-grid">
                    <% if (services && services.length> 0) { %>
                        <% services.forEach(service=> { %>
                            <div class="subdomain-service-item">
                                <h2>
                                    <%= service.title %>
                                </h2>
                                <p class="subdomain-service-description">
                                    <%= service.description %>
                                </p>
                                <div class="subdomain-service-details">
                                    <span class="subdomain-service-cost">
                                        <%= service.cost %>
                                    </span>
                                    <span class="subdomain-service-duration">
                                        <%= service.duration %>
                                    </span>
                                </div>
                                <p class="subdomain-service-location">
                                    <%= service.location %>
                                </p>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
                <div class="subdomain-footer">
                    <button class="subdomain-cta-button">Check back soon</button>
                    <div class="subdomain-powered-by">powered by syncset.xyz</div>
                </div>
            </div>
        </div>

        <script>
            window.addEventListener('message', (event) => {
                if (event.data.type === 'updatePreview') {
                    const { title, description, theme } = event.data.data;

                    if (title) document.getElementById('subdomain-title').textContent = title;
                    if (description) document.getElementById('subdomain-description').textContent = description;

                    document.body.className = theme === 'dark' ? 'dark-theme' : 'light-theme';
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                const calendar = {
                    currentDate: new Date(),
                    selectedDate: null,
                    
                    init() {
                        this.setupCalendarControls();
                        this.renderCalendar();
                    },

                    setupCalendarControls() {
                        document.getElementById('subdomain-prevMonth').addEventListener('click', () => {
                            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                            this.renderCalendar();
                        });

                        document.getElementById('subdomain-nextMonth').addEventListener('click', () => {
                            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                            this.renderCalendar();
                        });
                    },

                    renderCalendar() {
                        const year = this.currentDate.getFullYear();
                        const month = this.currentDate.getMonth();
                        
                        const monthNames = ["January", "February", "March", "April", "May", "June",
                                         "July", "August", "September", "October", "November", "December"];
                        document.getElementById('subdomain-currentMonth').textContent = `${monthNames[month]} ${year}`;

                        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                        document.querySelector('.subdomain-weekdays').innerHTML = weekdays.map(day => 
                            `<div class="subdomain-weekday">${day}</div>`
                        ).join('');

                        const firstDay = new Date(year, month, 1);
                        const lastDay = new Date(year, month + 1, 0);
                        const daysGrid = document.querySelector('.subdomain-days');
                        daysGrid.innerHTML = '';

                        for (let i = 0; i < firstDay.getDay(); i++) {
                            daysGrid.appendChild(this.createDayElement(''));
                        }

                        for (let day = 1; day <= lastDay.getDate(); day++) {
                            const dayElement = this.createDayElement(day);
                            if (this.isToday(year, month, day)) {
                                dayElement.classList.add('today');
                            }
                            if (this.selectedDate && 
                                this.selectedDate.getFullYear() === year && 
                                this.selectedDate.getMonth() === month && 
                                this.selectedDate.getDate() === day) {
                                dayElement.classList.add('selected');
                            }
                            daysGrid.appendChild(dayElement);
                        }
                    },

                    createDayElement(content) {
                        const div = document.createElement('div');
                        div.className = 'subdomain-day';
                        div.textContent = content;
                        
                        if (content !== '') {
                            const currentDate = new Date();
                            const dayDate = new Date(
                                this.currentDate.getFullYear(),
                                this.currentDate.getMonth(),
                                content
                            );
                            
                            if (dayDate < new Date(currentDate.setHours(0, 0, 0, 0))) {
                                div.classList.add('disabled');
                            } else {
                                div.addEventListener('click', () => {
                                    const previousSelected = document.querySelector('.subdomain-day.selected');
                                    if (previousSelected) {
                                        previousSelected.classList.remove('selected');
                                    }
                                    
                                    div.classList.add('selected');
                                    
                                    this.selectedDate = dayDate;
                                    
                                    window.parent.postMessage({
                                        type: 'dateSelected',
                                        date: this.selectedDate.toISOString()
                                    }, '*');
                                });
                            }
                        }
                        return div;
                    },

                    isToday(year, month, day) {
                        const today = new Date();
                        return today.getFullYear() === year && 
                               today.getMonth() === month && 
                               today.getDate() === day;
                    }
                };

                calendar.init();
            });
        </script>
    </body>
</html>