<!DOCTYPE html>
<html>
<%- include('includes/head', {title: title}) %>

    <body class="<%= domainData && domainData.theme === 'dark' ? 'dark-theme' : 'light-theme' %>">
        <div class="subdomain-container">
            <div class="content-section">
                <h1 id="subdomainTitle">
                    <%= title %>
                </h1>
                <p id="subdomainDescription">
                    <%= description %>
                </p>

                <div class="calendar-section">
                    <div class="calendar-grid">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button id="prevMonth" class="calendar-nav-btn">&lt;</button>
                                <h2 id="currentMonth">Month Year</h2>
                                <button id="nextMonth" class="calendar-nav-btn">&gt;</button>
                            </div>
                            <div class="calendar-body">
                                <div class="weekdays"></div>
                                <div class="days"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subdomain-services-grid">
                    <% if (services && services.length> 0) { %>
                        <% services.forEach(service=> { %>
                            <div class="subdomain-service-item">
                                <h2>
                                    <%= service.title %>
                                </h2>
                                <p class="subdomain-service-description">
                                    <%= service.description %>
                                </p>
                                <div class="subdomain-service-details">
                                    <span class="subdomain-service-cost">
                                        <%= service.cost %>
                                    </span>
                                    <span class="subdomain-service-duration">
                                        <%= service.duration %>
                                    </span>
                                </div>
                                <p class="subdomain-service-location">
                                    <%= service.location %>
                                </p>
                            </div>
                            <% }); %>
                                <% } %>
                </div>
                <div class="subdomain-footer">
                    <button class="cta-button">Check back soon</button>
                    <div class="powered-by">powered by syncset.xyz</div>
                </div>
            </div>

        </div>

        <script>
            window.addEventListener('message', (event) => {
                if (event.data.type === 'updatePreview') {
                    const { title, description, theme } = event.data.data;

                    if (title) document.getElementById('subdomainTitle').textContent = title;
                    if (description) document.getElementById('subdomainDescription').textContent = description;

                    document.body.className = theme === 'dark' ? 'dark-theme' : 'light-theme';
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                const calendar = {
                    currentDate: new Date(),
                    
                    init() {
                        this.setupCalendarControls();
                        this.renderCalendar();
                    },

                    setupCalendarControls() {
                        document.getElementById('prevMonth').addEventListener('click', () => {
                            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                            this.renderCalendar();
                        });

                        document.getElementById('nextMonth').addEventListener('click', () => {
                            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                            this.renderCalendar();
                        });
                    },

                    renderCalendar() {
                        const year = this.currentDate.getFullYear();
                        const month = this.currentDate.getMonth();
                        
                        const monthNames = ["January", "February", "March", "April", "May", "June",
                                         "July", "August", "September", "October", "November", "December"];
                        document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

                        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                        document.querySelector('.weekdays').innerHTML = weekdays.map(day => 
                            `<div class="weekday">${day}</div>`
                        ).join('');

                        const firstDay = new Date(year, month, 1);
                        const lastDay = new Date(year, month + 1, 0);
                        const daysGrid = document.querySelector('.days');
                        daysGrid.innerHTML = '';

                        for (let i = 0; i < firstDay.getDay(); i++) {
                            daysGrid.appendChild(this.createDayElement(''));
                        }

                        for (let day = 1; day <= lastDay.getDate(); day++) {
                            const dayElement = this.createDayElement(day);
                            if (this.isToday(year, month, day)) {
                                dayElement.classList.add('today');
                            }
                            daysGrid.appendChild(dayElement);
                        }
                    },

                    createDayElement(content) {
                        const div = document.createElement('div');
                        div.className = 'day';
                        div.textContent = content;
                        return div;
                    },

                    isToday(year, month, day) {
                        const today = new Date();
                        return today.getFullYear() === year && 
                               today.getMonth() === month && 
                               today.getDate() === day;
                    }
                };

                calendar.init();
            });
        </script>
    </body>

</html>